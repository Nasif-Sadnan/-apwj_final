<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Super Shop Inventory</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input, button, select { margin: 5px; padding: 8px; }
    table { border-collapse: collapse; margin-top: 15px; width: 100%; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: left; }
    th { background-color: #f0f0f0; }
  </style>
</head>
<body>

<h1>Super Shop Inventory</h1>


<h2>Add a Product</h2>
<form id="productForm">
  <input type="number" placeholder="ID" id="id" required>
  <input type="text" placeholder="Name" id="name" required>
  <select id="category">
    <option>BeautyCare</option>
    <option>Vegetables</option>
    <option>Meat</option>
    <option>Groceries</option>
    <option>Others</option>
  </select>
  <input type="number" placeholder="Price" id="price" required>
  <input type="number" placeholder="Quantity" id="quantity" required>
  <input type="date" id="expiryDate">
  <select id="availability">
    <option value="true">Available</option>
    <option value="false">Not Available</option>
  </select>
  <button type="submit">Add Product</button>
</form>


<h2>Update Product</h2>
<form id="updateForm">
  <input type="number" placeholder="ID" id="updateId" required>
  <input type="text" placeholder="Name" id="updateName" required>
  <select id="updateCategory">
    <option>BeautyCare</option>
    <option>Vegetables</option>
    <option>Meat</option>
    <option>Groceries</option>
    <option>Others</option>
  </select>
  <input type="number" placeholder="Price" id="updatePrice" required>
  <input type="number" placeholder="Quantity" id="updateQuantity" required>
  <input type="date" id="updateExpiryDate">
  <select id="updateAvailability">
    <option value="true">Available</option>
    <option value="false">Not Available</option>
  </select>
  <button type="submit">Update Product</button>
</form>

<hr>


<h2>All Products</h2>
<button onclick="fetchAllProducts()">Load All</button>
<table id="allTable"></table>


<h2>Get Product By ID</h2>
<input type="number" id="getId" placeholder="Enter ID">
<button onclick="fetchById()">Get Product</button>
<table id="idTable"></table>


<h2>Products by Category</h2>
<select id="getCategory">
  <option>BeautyCare</option>
  <option>Vegetables</option>
  <option>Meat</option>
  <option>Groceries</option>
  <option>Others</option>
</select>
<button onclick="fetchByCategory()">Load By Category</button>
<table id="categoryTable"></table>


<h2>Available Products</h2>
<button onclick="fetchAvailable()">Load Available Products</button>
<table id="availableTable"></table>


<h2>Expiring Soon (Next 7 Days)</h2>
<button onclick="fetchExpiring()">Load Expiring Products</button>
<table id="expiringTable"></table>


<h2>Discounted Products by Category</h2>
<form id="discountForm">
  <select id="discountCategory">
    <option>BeautyCare</option>
    <option>Vegetables</option>
    <option>Meat</option>
    <option>Groceries</option>
    <option>Others</option>
  </select>
  <input type="number" placeholder="Discount Rate (0.2 = 20%)" id="discountValue" min="0.01" max="0.99" step="0.01" required>
  <button type="submit">Get Discounted Products</button>
</form>
<table id="discountTable"></table>


<h2>Total Value Grouped By Category</h2>
<button onclick="fetchTotalValue()">Load Total Value Report</button>
<table id="totalValueTable"></table>


<h2>Delete Product</h2>
<input type="number" id="deleteId" placeholder="Enter ID to Delete">
<button onclick="deleteProduct()">Delete Product</button>

<script>
const api = 'http://localhost:8080/product'; 


document.getElementById('productForm').onsubmit = async function(e) {
  e.preventDefault();
  const product = {
    id: parseInt(document.getElementById('id').value),
    name: document.getElementById('name').value,
    category: document.getElementById('category').value,
    price: parseFloat(document.getElementById('price').value),
    quantity: parseInt(document.getElementById('quantity').value),
    expiryDate: document.getElementById('expiryDate').value || null,
    available: document.getElementById('availability').value === 'true'
  };
  await fetch(`${api}/add`, {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(product)
  });
  alert('Product added!');
  document.getElementById('productForm').reset();
};


document.getElementById('updateForm').onsubmit = async function(e) {
  e.preventDefault();
  const product = {
    id: parseInt(document.getElementById('updateId').value),
    name: document.getElementById('updateName').value,
    category: document.getElementById('updateCategory').value,
    price: parseFloat(document.getElementById('updatePrice').value),
    quantity: parseInt(document.getElementById('updateQuantity').value),
    expiryDate: document.getElementById('updateExpiryDate').value || null,
    available: document.getElementById('updateAvailability').value === 'true'
  };
  await fetch(`${api}/update`, {
    method: 'PUT',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify(product)
  });
  alert('Product updated!');
  document.getElementById('updateForm').reset();
};


async function fetchAllProducts() {
  const res = await fetch(`${api}/all`);
  const data = await res.json();
  renderTable('allTable', data);
}


async function fetchById() {
  const id = document.getElementById('getId').value;
  const res = await fetch(`${api}/${id}`);
  const data = await res.json();
  renderTable('idTable', [data]);
}


async function fetchByCategory() {
  const category = document.getElementById('getCategory').value;
  const res = await fetch(`${api}/category/${category}`);
  const data = await res.json();
  renderTable('categoryTable', data);
}


async function fetchAvailable() {
  const res = await fetch(`${api}/available`);
  const data = await res.json();
  renderTable('availableTable', data);
}


async function fetchExpiring() {
  const res = await fetch(`${api}/expiring`);
  const data = await res.json();
  renderTable('expiringTable', data);
}


document.getElementById('discountForm').onsubmit = async function(e) {
  e.preventDefault();
  const category = document.getElementById('discountCategory').value;
  const rate = parseFloat(document.getElementById('discountValue').value);
  const res = await fetch(`${api}/discount?category=${category}&rate=${rate}`);
  const data = await res.json();
  renderDiscountTable('discountTable', data, rate);
};


async function fetchTotalValue() {
  const res = await fetch(`${api}/report/total-value`);
  const data = await res.json();
  renderTotalValueTable('totalValueTable', data);
}


async function deleteProduct() {
  const id = document.getElementById('deleteId').value;
  await fetch(`${api}/delete/${id}`, { method: 'DELETE' });
  alert('Product deleted!');
}


function renderTable(tableId, data) {
  let html = '<tr><th>ID</th><th>Name</th><th>Category</th><th>Price</th><th>Qty</th><th>Expiry</th><th>Available</th></tr>';
  data.forEach(p => {
    html += `<tr>
      <td>${p.id}</td>
      <td>${p.name}</td>
      <td>${p.category}</td>
      <td>${p.price.toFixed(2)}</td>
      <td>${p.quantity}</td>
      <td>${p.expiryDate ? p.expiryDate : '—'}</td>
      <td>${p.available ? 'Yes' : 'No'}</td>
    </tr>`;
  });
  document.getElementById(tableId).innerHTML = html;
}


function renderDiscountTable(tableId, data, discountRate) {
  let html = '<tr><th>ID</th><th>Name</th><th>Category</th><th>Original Price</th><th>Discounted Price</th><th>Qty</th><th>Expiry</th><th>Available</th></tr>';
  data.forEach(p => {
    const discountedPrice = p.price.toFixed(2);
    const originalPrice = (p.price / (1 - discountRate)).toFixed(2);
    html += `<tr>
      <td>${p.id}</td>
      <td>${p.name}</td>
      <td>${p.category}</td>
      <td>${originalPrice}</td>
      <td>${discountedPrice}</td>
      <td>${p.quantity}</td>
      <td>${p.expiryDate ? p.expiryDate : '—'}</td>
      <td>${p.available ? 'Yes' : 'No'}</td>
    </tr>`;
  });
  document.getElementById(tableId).innerHTML = html;
}


function renderTotalValueTable(tableId, data) {
  let html = '<tr><th>Category</th><th>Total Value</th></tr>';
  for (const [category, value] of Object.entries(data)) {
    html += `<tr>
      <td>${category}</td>
      <td>${value.toFixed(2)}</td>
    </tr>`;
  }
  document.getElementById(tableId).innerHTML = html;
}
</script>

</body>
</html>
